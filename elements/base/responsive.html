<link href="element.html" rel="import">

<script>
  (function () {
    /* globals Chefdoeurve, window */

    class ResponsiveElement extends Chefdoeurve.CustomElement {
      constructor() {
        super();
        this.mediaQueryList = {};
        this.handleMediaQueryCallback = this.handleMediaQueryCallback.bind(this);
      }

      mediaQuery(query, style) {
        const list = window.matchMedia(query);
        list.addListener(this.handleMediaQueryCallback);
        this.mediaQueryList[query] = { list, style };
      }

      mediaQueries(queries) {
        queries.forEach(q => this.mediaQuery(q.query, q.style));
      }

      handleMediaQueryCallback() {
        this.configStyle();
      }

      get mediaStyles() {
        return Object.values(this.mediaQueryList)
          .reduce((styles, query) => {
            if (query.list.matches) {
              Object.assign(styles, query.style);
            }
            return styles;
          }, {});
      }

      configStyle() {
        super.configStyle();
        Object.assign(this.style, this.mediaStyles);
      }

      disconnectedCallback() {
        Object.values(this.mediaQueryList)
          .forEach((query) => {
            query.list.removeListener(this.handleMediaQueryCallback);
          });
      }
    }

    Chefdoeurve.ResponsiveElement = ResponsiveElement;
  }());
</script>
