<link rel="import" href="./responsive.html">


<script>
  (function () {
    /* globals Chefdoeurve, window */

    class ScreenElement extends Chefdoeurve.ResponsiveElement {
      constructor() {
        super();
        this.screenSizing = {
          xs: window.matchMedia('(min-width: 0)'),
          sm: window.matchMedia('(min-width: 600px)'),
          md: window.matchMedia('(min-width: 960px)'),
          lg: window.matchMedia('(min-width: 1264px)'),
          xl: window.matchMedia('(min-width: 1904px)'),
        };

        this.handleScreenResize = this.handleScreenResize.bind(this);

        Object.values(this.screenSizing)
          .forEach(q => q.addListener(this.handleScreenResize));
      }

      get screenSize() {
        return Object.keys(this.screenSizing).reverse()
          .reduce((match, key) => {
            if (this.screenSizing[key].matches) {
              return key;
            }
            return match;
          }, 'xs');
      }

      handleScreenResize() {
        this.configStyle();
      }

      configStyle() {
        super.configStyle();
        Object.keys(this.screenSizing)
          .forEach((size) => {
            const key = `${size}ScreenStyle`;
            if (this.screenSizing[size].matches && key in this) {
              Object.assign(this.style, this[`${size}ScreenStyle`]);
            }
          });
      }

      disconnectedCallback() {
        super.disconnectedCallback();
        Object.values(this.screenSizing)
          .forEach((query) => {
            query.removeListener(this.handleScreenResize);
          });
      }
    }

    Chefdoeurve.ScreenElement = ScreenElement;
  }());
</script>

